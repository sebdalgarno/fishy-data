---
title: "Hidden Markov Models for fish movement"
description: |
  Exploring the use of HMMs for understanding fish movement and behaviour from capture-recapture and acoustic telemetry data. 
author:
  - name: Seb Dalgarno
    url: https://github.com/sebdalgarno
date: 04-15-2021
output:
  distill::distill_article:
    self_contained: false
draft: false
categories:
  - Stats
  - Movement Ecology
  - Hidden Markov Model
twitter:
  site: "@sebdalgarno"
  creator: "@sebdalgarno"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# What is a Hidden Markov Model?
Hidden Markov Models (HMM) can be used for ecological time series data to uncover hidden ecological states (McClintock et al. 2020). They do this by disentangling the observation process from the underlying (unobserved and hidden) state process. One important use for HMM is in movement ecology, where we can parse an animal's movement path into several states that might correspond to behaviour (e.g., spawning, feeding), physiology, resource selection, etc. 

A HMM is a heirarchical model consisting of a model for the observation process (observation model) and a model for the state process (process model). It is a special case of state-space model with a finite number of possible states in the process model. The state process is not directyl observed; rather it is a hidden (or latent) variable. The observations (e.g., from telemetry or capture-recapture), which make up the observation model, are generated by the underlying state process but are 'noisy' measurements and are insufficient when considered alone to determine the state. 

HMMs have two major simplifying assumptions, one each for the state process and observation process. A major assumption for the state process is the Markov property - the probability of a state being active at time *t* is dependent on the state at time *t - 1*. A major assumption for the observation process is conditional independence - the probability distribution of an observation at time *t* is completely dependent on the state at time *t* (and is independent of any other states or observations). 

# How is a HMM specified?

A HMM is specified with three major componenets:   

1. **intitial distribution** - a vector of probabilities for each state at the start of the time sequence.  
1. **state transition probabilities** - a matrix of probabilities for switching from any state at time *t* to another state at time *t + 1*.    
1. **state-dependent distribution** - probability distribution of an observation conditional on the state at time *t*. This depends on the form of the observed data, e.g. count data are poisson distributed, positive continous data may be gamm distributed, etc.  

A model can be fit using Maximum Likelihood or Bayesian methods. 

# Application of HMM to fish movement

A HMM can be applied to a wide variety of questions about the existential, developmental and spatial states of fish (or other animals) at the level of individual, population, community or ecosystem. Here, let's explore three potential applications for understanding fish movement/behaviour at the individual level from capture-recapture and acoustic telemetry data.

### Survival
We can estimate surival (an existential question) using the Cormack-Jolly Seber model, with 2 states (alive and dead),where the probability of transitioning from dead to alive is set at 0. 

![Specification for a survival HMM (McClintock et al. 2020)](survival-hmm.png)

### Behavioral state (or movement phase)
In order to explore behaviours, we can extend the 'alive' state into multiple states, e.g. 'alive and breeding', 'alive and non-breeding'. 
Disentangling multiple states from animal movement data can help to identify, for example, migratory phases, predation/feeding events, or hibernation/overwintering cycles. In these multi-state models of animal movement, observations are typically expressed as trajectories in 2-dimensional space, i.e., bivariate sequence of step-length (Euclidean distance) and turning angle. A two-state model could consist of 'resident' and 'transient', where movements in the 'transient' state correspond to longer step-lengths and more persistent turning angles. Step-length is typically considered to follow a gamma or Weibull probability distribution and turning angle is typically modeled with a von Mises or wrapped Cauchy distribution. The number of states in these types of models are typically not clear *a priori* and therefore need to be selected based on biological understanding and possibly, model selection. The state transition probabilities are also not predetermined, but rather are freely estimated by the model and are completely data-driven. 

![Specification for a multi-state behaviour HMM with bivariate observation process (McClintock et al. 2020)](behaviour-hmm.png)

### Spatial location
We can predict movement to or from specific spatial locations, where each state corresponds to a site (e.g. spawning vs overwintering site). This follows the same model specification as the above behaviour example, but the observations are univariate site locations (e.g. A, B, and 0, where A and B might correspond to a spawning site and overwintering site, respectively, and 0 is unknown location). State transition probabilities in this case are interpreted as probability of fidelity/dispersal. In this case, we could use the model to predict specific location at times in the observation sequence where location is unknown. Note, a state-space model or spatial capture-recapture model may be more appropriate in this case for prediction of continous location or activity center in 2-d space. 
![Specification for a spatial HMM where observations correspond to a site (McClintock et al. 2020)](spatial-hmm.png)


